<mat-card class="register-card">
  <h3>Créer un compte</h3>
  <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Prénom</mat-label>
      <input
        matInput
        formControlName="firstName"
        [attr.aria-label]="'Prénom'"
        [attr.aria-required]="true"
        required
      />
      <mat-error *ngIf="registerForm.get('firstName')?.hasError('required')">
        Veuillez entrer votre prénom.
      </mat-error>
      <mat-error *ngIf="registerForm.get('firstName')?.hasError('invalidName')">
        Format de prénom invalide.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Nom</mat-label>
      <input
        matInput
        formControlName="lastName"
        [attr.aria-label]="'Nom'"
        [attr.aria-required]="true"
        required
      />
      <mat-error *ngIf="registerForm.get('lastName')?.hasError('required')">
        Veuillez entrer votre nom.
      </mat-error>
      <mat-error *ngIf="registerForm.get('lastName')?.hasError('invalidName')">
        Format de nom invalide.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Nom d'utilisateur</mat-label>
      <input
        matInput
        formControlName="username"
        [attr.aria-label]="'Nom d`\'utilisateur'"
        [attr.aria-required]="true"
        required
      />
      <mat-error *ngIf="registerForm.get('username')?.hasError('required')">
        Veuillez entrer un nom d'utilisateur.
      </mat-error>
      <mat-error *ngIf="registerForm.get('username')?.hasError('invalidUsername')">
        Caractères alphanumériques uniquement.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Adresse e-mail</mat-label>
      <input
        matInput
        formControlName="email"
        autocomplete="email"
        [attr.aria-label]="'Adresse e-mail'"
        [attr.aria-required]="true"
        required
        spellcheck="false"
        type="email"
      />
      <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
        Veuillez entrer une adresse e-mail.
      </mat-error>
      <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
        Format d'adresse e-mail invalide.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Mot de passe</mat-label>
      <input
        matInput
        [type]="showPassword ? 'text' : 'password'"
        formControlName="password"
        autocomplete="new-password"
        spellcheck="false"
        [attr.aria-label]="'Mot de passe'"
        [attr.aria-required]="true"
        type="password"
      />
      <button
        mat-icon-button
        matSuffix
        (click)="togglePasswordVisibility()"
        type="button"
        [attr.aria-label]="'Afficher/Masquer mot de passe'"
      >
        <mat-icon>{{ showPassword ? "visibility_off" : "visibility" }}</mat-icon>
      </button>
      <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
        Veuillez entrer un mot de passe.
      </mat-error>
      <mat-error *ngIf="registerForm.get('password')?.hasError('passwordStrength')">
        ≥12 (majuscule, minuscule, chiffre, spécial).
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Confirmer le mot de passe</mat-label>
      <input
        matInput
        [type]="showPassword ? 'text' : 'password'"
        formControlName="confirmPassword"
        autocomplete="new-password"
        spellcheck="false"
        [attr.aria-label]="'Confirmer le mot de passe'"
        [attr.aria-required]="true"
        type="password"
      />
      <button
        mat-icon-button
        matSuffix
        (click)="togglePasswordVisibility()"
        type="button"
        [attr.aria-label]="'Afficher/Masquer mot de passe'"
      >
        <mat-icon>{{ showPassword ? "visibility_off" : "visibility" }}</mat-icon>
      </button>
      <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
        Veuillez confirmer votre mot de passe.
      </mat-error>
      <mat-error *ngIf="registerForm.hasError('passwordMismatch')">
        Les mots de passe ne correspondent pas.
      </mat-error>
    </mat-form-field>

    <mat-checkbox formControlName="agreedPolicy">
      J'ai lu et j'accepte la
      <button mat-button type="button" (click)="openPrivacyPolicy()">Politique</button>
    </mat-checkbox>
    <mat-error
      *ngIf="
        registerForm.get('agreedPolicy')?.hasError('required') &&
        registerForm.get('agreedPolicy')?.touched
      "
    >
      L'acceptation de la politique de confidentialité est requise pour utiliser l'application.
    </mat-error>

    <mat-checkbox formControlName="agreedCgvCgu">
      J'accepte les
      <button mat-button type="button" (click)="openCguCgv()">CGU/CGV</button>
    </mat-checkbox>
    <mat-error
      *ngIf="
        registerForm.get('agreedCgvCgu')?.hasError('required') &&
        registerForm.get('agreedCgvCgu')?.touched
      "
    >
      L'acceptation des CGU/CGV est requise pour utiliser l'application.
    </mat-error>

    <button mat-raised-button color="primary" class="full-width" [disabled]="registerForm.invalid">
      Créer votre compte
    </button>
  </form>
</mat-card>
